{% extends "app/layout.html" %}

{% block content %}
<div align="center" style="margin:10px;padding:0">
    <select id="selFilter" class="selectpicker" data-style="btn-main" onchange="FilterChange()" >
        <option value="completed">Completed</option>
        <option value="upcoming" selected>Upcoming</option>
        <option value="purchased">Purchased</option>
    </select>
    <div>
	    <div id="divCompetitions" style="display:inline-block;vertical-align: top;padding:3px;display:inline-block" >
	        <div id="divCompHeader" style="padding-bottom:5px;font-size:22px;font-weight:bold;text-align:center">Competition</div>
	        <div id="divCompList"class="listbox  setup-box"  style="width:800px;"></div><br/>
	    </div>
    </div>
    <br/>
    <br/>
    <div>
        <button href="#" id="btnView" type="button" class="btn-main btn-wide ui-disabled pt-4 pb-4" style="border-radius: 1rem;" onclick="btnViewClick()">View</button>
        <div id="divGetAccess" style="display:none">
            <button href="#" id="btnPurchase" type="button" class="btn-main btn-wide pt-4 pb-4" style="border-radius: 1rem;" onclick="btnPurchaseAccessClick()">Get Access</button><br/>
            <span style="font-size:.8rem">Have an Access Code? <a href="#" onclick="EnterAccessCode()">Enter it here</a></span>
        </div>
        <br/><br/>
    </div>
		
</div>

{% endblock %}

{% block scripts %}
<script type="text/javascript">
    var token = "{{ csrf_token }}";
</script>
<script src="https://js.stripe.com/v3/"></script>
<script type="text/javascript">
    var SelectedSession = -1;
    FilterChange();
    $('.selectpicker').selectpicker();

    function FilterChange() {
        SelectedSession = -1;
        $("#divCompList").load("/management/competition_list_spectator/?filter=" + $("#selFilter").val());
        $("#btnView").addClass("ui-disabled");
        $("#divGetAccess").hide();
        $("#btnView").show();
    }

   function SessionClick(sesIn) {
        $('.session-list').removeClass("ctxSelected");
        $("#trSession" + sesIn).addClass("ctxSelected");
        SelectedSession = sesIn;
        CheckSessionAccess(SelectedSession)
    }
   

    function btnPurchaseAccessClick() {
        if (SelectedSession != -1) {
            $("#modalMainTitle").html("Get Spectator Access");
            $("#modalBodyArea2").hide();
            $("#modalBodyArea1").empty();
            $("#modalBodyArea1").load("/account/stripe_payment_screen/" + SelectedSession + "/SPECTATOR/1", function () {
            });
            $("#modalMain").modal('show');
            $("#modalBodyArea1").show();
        }
    }

    function EnterAccessCode() {
        if (SelectedSession != -1) {
            $("#modalMainTitle").html("Get Spectator Access");
            $("#modalBodyArea2").hide();
            $("#modalBodyArea1").empty();
            $("#modalBodyArea1").load("/management/enter_access_code/" + SelectedSession + "", function () {
            });
            $("#modalMain").modal('show');
            $("#modalBodyArea1").show();
        }
    }

    function btnViewClick() {
        if (SelectedSession != -1) {
            if ($("#selFilter").val()=="completed")
                window.location = "/scoreboard/?ses=" + SelectedSession;
            else
                window.location = "/spectate/" + SelectedSession + "/single/";
        }
    }

    function CompClick(CompIn) {
        
        $('.comp-list').removeClass("ctxSelected");
        $("#divComp" + CompIn).addClass("ctxSelected");
        SelectedComp = CompIn;
        $("#divSessions").removeClass("ui-disabled");
        FillSession();
        $("#divGetAccess").hide();
        $("#btnView").show();
        $("#btnView").addClass("ui-disabled");

    }

    function CheckSessionAccess(ses) {
        $.ajax({
            url: "/account/check_session_access/" + ses + "/",
            success: function (data) {
                console.log(data)
                if (data == "Yes") {
                    $("#divGetAccess").hide();
                    $("#btnView").removeClass("ui-disabled");
                    $("#btnView").show();
                }
                else {
                    $("#btnView").hide();
                    $("#divGetAccess").show();
                }
            }
        });

    }

</script>
{% endblock %}
